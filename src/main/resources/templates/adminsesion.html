<!doctype html>
<html lang="en">

    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

        <link rel="stylesheet" th:href="@{/css/admin.css}" />

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <title>Albion - Administracion</title>
    </head>

    <body th:style="'background-image: url(' + @{/img/taller.jpg} + ');'">
        <a th:href="@{/logout}">Salir</a>
        <div class="adminmenu">
            <a th:href="@{/logout}"><img src="/img/logo.png" alt=""></a>
            <p th:if="${exito}!=null" th:text="${exito}" style="color:green"></p>
            <p th:if="${error}!=null" th:text="${error}" style="color:red"></p>
            <div class="btn-group dropend">
                <button type="button" class="contactar dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Crear
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#crearProducto">Crear Producto</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#crearFuncion">Crear Funcion</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#crearLinea">Crear Linea</a></li>
                </ul>
            </div>
            <div class="btn-group dropend">
                <button type="button" class="contactar dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Editar
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#editarProducto">Editar Producto</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#editarFuncion">Editar Funcion</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#editarLinea">Editar Linea</a></li>
                </ul>
            </div>
            <div class="btn-group dropend">
                <button type="button" class="contactar dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Ordenar
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#ordenarProducto">Ordenar Producto</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#ordenarFuncion">Ordenar Funcion</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#ordenarLinea">Ordenar Linea</a></li>
                </ul>
            </div>
            <div class="btn-group dropend">
                <button type="button" class="contactar dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Fotos
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#fotosLinea">Fotos Lineas</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#editarFotosLinea">Editar Fotos Lineas</a></li>
                    <li><a class="dropdown-item" data-bs-toggle="modal" href="#fotosEquipo">Fotos Equipos</a></li>
                </ul>
            </div>
        </div>


        <!-- Crear Producto -->
        <div class="modal fade" id="crearProducto" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Crear Producto</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form th:action="@{/crearProducto}" method="POST" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Producto Español</label>
                                <input type="text" name="producto_es" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Producto Inglés</label>
                                <input type="text" name="producto_en" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Producto Francés</label>
                                <input type="text" name="producto_fr" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Producto Brasil</label>
                                <input type="text" name="producto_br" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="mb-3">
                                <label class="form-label" for="inputGroupFile01">Foto</label>
                                <input name="foto" type="file" class="form-control" id="inputGroupFile01">
                            </div>
                            <button type="submit" class="contactar">Crear</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crear Funcion -->
        <div class="modal fade" id="crearFuncion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Crear Funcion</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form th:action="@{/crearFuncion}" method="POST" >
                            <label for="exampleInputEmail1" class="form-label">Producto</label>
                            <p th:text="${newfuncion.funcion_es}"></p>
                            <select name="producto_es" required class="form-select" aria-label="Default select example">
                                <option  th:each="producto : ${producto}" th:value="${producto.producto_es}"  th:text="${producto.producto_es}" th:selected="${producto.producto_es == newfuncion.funcion_es}" ></option>
                            </select>
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Funcion Español</label>
                                <input type="text" name="funcion_es" class="form-control" id="exampleInputEmail1" th:value="${newfuncion.funcion_es}" required>
                            </div>
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Funcion Inglés</label>
                                <input type="text" name="funcion_en" class="form-control" id="exampleInputEmail1" th:value="${newfuncion.funcion_en}">
                            </div>
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Funcion Francés</label>
                                <input type="text" name="funcion_fr" class="form-control" id="exampleInputEmail1" th:value="${newfuncion.funcion_fr}">
                            </div>
                            <div class="mb-3">
                                <label for="exampleInputEmail1" class="form-label">Funcion Brasil</label>
                                <input type="text" name="funcion_br" class="form-control" id="exampleInputEmail1" th:value="${newfuncion.funcion_br}">
                            </div>
                            <button type="submit" class="contactar">Crear</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Crear Linea -->
        <div class="modal fade" id="crearLinea" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Crear Linea</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form class="row g-3" th:action="@{/crearLinea}" method="POST" enctype="multipart/form-data">
                            <div class="col-md-6">
                                <label for="producto">Seleccionar Producto:</label>
                                <select name="producto" id="select-producto-crearLinea" onchange="cargarFuncionesCrearLinea()">
                                    <option value="">Seleccionar</option>
                                    <!-- Iterar sobre los productos y generar las opciones del select -->
                                    <option th:each="producto : ${producto}" th:value="${producto.id}" th:text="${producto.producto_es}"></option>
                                </select>

                                <label for="funcion">Seleccionar Función:</label>
                                <select name="funcionId" id="select-funcion-crearLinea">
                                    <option value="">Seleccionar</option>
                                </select>
                            </div>
                            <script th:inline="javascript">
                                function cargarFuncionesCrearLinea() {
                                var productoId = $('#select-producto-crearLinea').val();

                                if (productoId) {
                                var url = /*[[@{/productos/{id}/buscarFunciones}]]*/ '';
                                url = url.replace('{id}', productoId);

                                $.ajax({
                                url: url,
                                type: 'GET',
                                success: function(data) {
                                // Limpiar el select de funciones
                                $('#select-funcion-crearLinea').empty();
                                $('#select-funcion-crearLinea').append('<option value="">Seleccionar</option>');

                                // Iterar sobre las funciones y generar las opciones del select
                                $.each(data, function(index, funcion) {
                                $('#select-funcion-crearLinea').append('<option value="' + funcion.id + '">' + funcion.funcion_es + '</option>');
                                });
                                },
                                error: function() {
                                console.log('Error al obtener las funciones del producto');
                                }
                                });
                                } else {
                                $('#select-funcion-crearLinea').empty();
                                $('#crearLineasBody').empty();
                                }
                                }
                            </script>

                            <div class="col-md-4">
                                <label for="exampleInputEmail1" class="form-label">Modelo</label>
                                <input type="text" name="modelo" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="col-md-4">
                                <label for="exampleInputEmail1" class="form-label">Configuración</label>
                                <input type="text" name="configuracion" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="col-md-4">
                                <label for="exampleInputEmail1" class="form-label">Producción</label>
                                <input type="text" name="produccion" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="col-md-3">
                                <label for="exampleInputEmail1" class="form-label">Título Español</label>
                                <input type="text" name="titulo_es" class="form-control" id="exampleInputEmail1">
                            </div>
                            <div class="col-md-3">
                                <label for="exampleInputEmail1" class="form-label">Título Inglés</label>
                                <input type="text" name="titulo_en" class="form-control" id="exampleInputEmail1">
                            </div>
                            <!--                            <div class="col-md-3">
                                                            <label for="exampleInputEmail1" class="form-label">Título Francés</label>
                                                            <input type="text" name="titulo_fr" class="form-control" id="exampleInputEmail1">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="exampleInputEmail1" class="form-label">Título Brasil</label>
                                                            <input type="text" name="titulo_br" class="form-control" id="exampleInputEmail1">
                                                        </div>-->
                            <div class="col-md-3">
                                <label for="exampleFormControlTextarea1" class="form-label">Descripción Español</label>
                                <textarea name="descripcion_es" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                            </div>
                            <div class="col-md-3">
                                <label for="exampleFormControlTextarea1" class="form-label">Descripción Inglés</label>
                                <textarea name="descripcion_en" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                            </div>
                            <!--                            <div class="col-md-3">
                                                            <label for="exampleFormControlTextarea1" class="form-label">Descripción Francés</label>
                                                            <textarea name="descripcion_fr" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="exampleFormControlTextarea1" class="form-label">Descripción Brasil</label>
                                                            <textarea name="descripcion_br" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                                        </div>-->
                            <!--                            <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 1</label>
                                                            <input name="archivo1" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 2</label>
                                                            <input name="archivo2" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 3</label>
                                                            <input name="archivo3" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 4</label>
                                                            <input name="archivo4" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 5</label>
                                                            <input name="archivo5" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 6</label>
                                                            <input name="archivo6" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 7</label>
                                                            <input name="archivo7" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label class="form-label" for="inputGroupFile01">Foto 8</label>
                                                            <input name="archivo8" type="file" class="form-control" id="inputGroupFile01">
                                                        </div>-->
                            <button type="submit" class="contactar">Crear</button>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Editar Producto -->
        <div class="modal fade" id="editarProducto" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Producto</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">


                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Editar</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="producto : ${producto}">
                            <form th:action="@{/producto/editar}" method="POST" >
                                <td>
                                    <input type="text" name="producto_es" th:value="${producto.producto_es}"/> <br/>
                                    <input type="text" name="producto_en" th:value="${producto.producto_en}"/><br/>
                                    <input type="text" name="producto_fr" th:value="${producto.producto_fr}"/> <br/>
                                    <input type="text" name="producto_br" th:value="${producto.producto_br}"/>
                                    <input type="hidden" name="id" th:value="${producto.id}"/>
                                </td>
                                <td>
                                    <button type="submit">Editar</button> <br/>
                                    <a th:if="${producto.alta == false}" th:href="@{/producto/eliminar/{id}(id=${producto.id})}">Alta</a>
                                    <a th:if="${producto.alta == true}" th:href="@{/producto/eliminar/{id}(id=${producto.id})}">Baja</a>
                                    <br/>
                                    <a href="" id="eliminarProducto">Eliminar</a>

                                    <script th:inline="javascript">
                                        $(document).ready(function() {
                                        $('#eliminarProducto').click(function(event) {
                                        event.preventDefault(); // Evita el comportamiento predeterminado del enlace

                                        var id = /*[[${producto.id}]]*/ null; // Obtén el ID del producto utilizando la sintaxis de Thymeleaf

                                        $.ajax({
                                        url: /*[[@{/eliminar/producto/{id}(id=${producto.id})}]]*/,
                                        method: 'POST',
                                        data: { param1: 'valor1', param2: 'valor2' },
                                        success: function(response) {
                                        // Manejar la respuesta
                                        },
                                        error: function(xhr, status, error) {
                                        // Manejar el error
                                        }
                                        });
                                        });
                                        });
                                    </script>


                                </td>
                            </form>
                            </tr>
                            </tbody>
                        </table>



                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Editar Funcion -->
        <div class="modal fade" id="editarFuncion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Funcion</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form th:action="@{/funcion/editar}" method="post">
                            <label for="producto">Seleccionar Producto:</label>
                            <select name="producto" id="select-editarFuncion" onchange="cargarEditarFuncion()">
                                <option value="">Seleccionar</option>
                                <option th:each="producto : ${producto}" th:value="${producto.id}" th:text="${producto.producto_es}" th:selected="${producto.producto_es == newfuncion.funcion_es}"></option>
                            </select>

                            <!-- Tabla de funciones -->
                            <table id="editarFunciones">
                                <thead>
                                    <tr>
                                        <th>Función ES</th>
                                        <th>Función EN</th>
                                        <th>Función FR</th>
                                        <th>Función BR</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>

                            <button type="submit">Guardar cambios</button>
                        </form>
                        <script th:inline="javascript">
                            function cargarEditarFuncion() {
                            var productoId = $('#select-editarFuncion').val();

                            if (productoId) {
                            var url = /*[[@{/productos/{id}/buscarFunciones}]]*/ '';
                            url = url.replace('{id}', productoId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar la tabla de funciones
                            $('#editarFunciones tbody').empty();

                            // Iterar sobre las funciones y generar las filas de la tabla
                            $.each(data, function(index, funcion) {
                            var fila = $('<tr>');
                            fila.append('<td><input type="text" name="funcion_es" value="' + funcion.funcion_es + '"></td>');
                            fila.append('<td><input type="text" name="funcion_en" value="' + funcion.funcion_en + '"></td>');
                            fila.append('<td><input type="text" name="funcion_fr" value="' + funcion.funcion_fr + '"></td>');
                            fila.append('<td><input type="text" name="funcion_br" value="' + funcion.funcion_br + '"></td>');
                            fila.append('<td><input type="hidden" name="id" value="' + funcion.id + '"></td>');

                            $('#editarFunciones tbody').append(fila);
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las funciones del producto');
                            }
                            });
                            } else {
                            $('#editarFunciones tbody').empty();
                            }
                            }
                        </script>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Editar Linea -->
        <div class="modal fade" id="editarLinea" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Linea</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form th:action="@{/linea/editar}" method="post" enctype="multipart/form-data">
                            <label for="producto">Seleccionar Producto:</label>
                            <select name="producto" id="select-producto-editarLinea" onchange="cargarFuncionesEditarLinea()">
                                <option value="">Seleccionar</option>
                                <!-- Iterar sobre los productos y generar las opciones del select -->
                                <option th:each="producto : ${producto}" th:value="${producto.id}" th:text="${producto.producto_es}"></option>
                            </select>

                            <label for="funcion">Seleccionar Función:</label>
                            <select name="funcion" id="select-funcion-editarLinea" onchange="cargarLineasEditarLineas()">
                                <option value="">Seleccionar</option>
                            </select>

                            <!-- Tabla de líneas -->
                            <table id="editarLineas">
                                <thead>
                                    <tr>
                                        <th>Modelo</th>
                                        <th>Configuracion</th>
                                        <th>Produccion</th>
                                        <th>Titulo Es</th>
                                        <th>Titulo En</th>
                                        <th>Titulo Fr</th>
                                        <th>Titulo Br</th>
                                        <th>Descripcion Es</th>
                                        <th>Descripcion En</th>
                                        <th>Descripcion Fr</th>
                                        <th>Descripcion Br</th>
                                    </tr>
                                </thead>
                                <tbody id="editarLineasBody">
                                </tbody>
                            </table>

                            <button type="submit">Guardar cambios</button>
                        </form>

                        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                        <script>
                            function eliminarFoto(id) {
                            $.ajax({
                            url: '/foto/eliminar/' + id,
                            type: 'DELETE',
                            success: function () {
                            // La foto se eliminó correctamente, puedes realizar alguna acción adicional aquí si lo deseas
                            alert('La foto se eliminó con éxito');
                            // Puedes redirigir a alguna página después de eliminar la foto, por ejemplo:
                            window.location.href = '/adminsesion';
                            },
                            error: function () {
                            // Ocurrió un error al eliminar la foto
                            alert('Error al eliminar la foto');
                            }
                            });
                            }
                        </script>
                        <script th:inline="javascript">

                            function cargarFuncionesEditarLinea() {
                            var productoId = $('#select-producto-editarLinea').val();

                            if (productoId) {
                            var url = /*[[@{/productos/{id}/buscarFunciones}]]*/ '';
                            url = url.replace('{id}', productoId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar el select de funciones
                            $('#select-funcion-editarLinea').empty();
                            $('#select-funcion-editarLinea').append('<option value="">Seleccionar</option>');

                            // Iterar sobre las funciones y generar las opciones del select
                            $.each(data, function(index, funcion) {
                            $('#select-funcion-editarLinea').append('<option value="' + funcion.id + '">' + funcion.funcion_es + '</option>');
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las funciones del producto');
                            }
                            });
                            } else {
                            $('#select-funcion-editarLinea').empty();
                            $('#editarLineasBody').empty();
                            }
                            }

                            function cargarLineasEditarLineas() {
                            var funcionId = $('#select-funcion-editarLinea').val();

                            if (funcionId) {
                            var url = /*[[@{/funciones/{id}/buscarLineas}]]*/ '';
                            url = url.replace('{id}', funcionId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            var editarLineasBody = $('#editarLineasBody');
                            editarLineasBody.empty();

                            $.each(data, function(index, linea) {
                            var fila = $('<tr>');
                            fila.append('<td><input type="text" name="modelo" value="' + linea.modelo + '"></td>');
                            fila.append('<td><input type="text" name="configuracion" value="' + linea.configuracion + '"></td>');
                            fila.append('<td><input type="text" name="produccion" value="' + linea.produccion + '"></td>');
                            fila.append('<td><input type="text" name="titulo_es" value="' + linea.titulo_es + '"></td>');
                            fila.append('<td><input type="text" name="titulo_en" value="' + linea.titulo_en + '"></td>');
                            fila.append('<td><input type="text" name="titulo_fr" value="' + linea.titulo_fr + '"></td>');
                            fila.append('<td><input type="text" name="titulo_br" value="' + linea.titulo_br + '"></td>');
                            fila.append('<td><input type="text" name="descripcion_es" value="' + linea.descripcion_es + '"></td>');
                            fila.append('<td><input type="text" name="descripcion_en" value="' + linea.descripcion_en + '"></td>');
                            fila.append('<td><input type="text" name="descripcion_fr" value="' + linea.descripcion_fr + '"></td>');
                            fila.append('<td><input type="text" name="descripcion_br" value="' + linea.descripcion_br + '"></td>');
                            fila.append('<td><input type="hidden" name="id" value="' + linea.id + '"></td>');

                            editarLineasBody.append(fila);
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las líneas de la función');
                            }
                            });
                            } else {
                            $('#editarLineasBody').empty();
                            }
                            }

                        </script>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Ordenar Producto -->
        <div class="modal fade" id="ordenarProducto" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Ordenar Producto</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <form th:action="@{/ordenarProducto}" method="POST" >
                            <table>
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Posición</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="producto : ${producto}">
                                        <td th:text="${producto.producto_es}"></td>
                                        <td>
                                            <input type="number" name="posicion" th:value="${producto.posicion}"/>
                                            <input type="hidden" name="id" th:value="${producto.id}" />
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <button type="submit">Ordenar</button>
                        </form>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ordenar Funcion -->
        <div class="modal fade" id="ordenarFuncion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Ordenar Funcion</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <form th:action="@{/ordenarFuncion}" method="post">
                            <label for="producto">Seleccionar Producto:</label>
                            <select name="producto" id="select-ordenarFunciones" onchange="cargarOrdenarFunciones()">
                                <option value="">Seleccionar</option>
                                <option th:each="producto : ${producto}" th:value="${producto.id}" th:text="${producto.producto_es}" th:selected="${producto.producto_es == newfuncion.funcion_es}"></option>
                            </select>

                            <!-- Tabla de funciones -->
                            <table id="ordenarFunciones">
                                <thead>
                                    <tr>
                                        <th>Función</th>
                                        <th>Posición</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>

                            <button type="submit">Guardar cambios</button>
                        </form>

                        <script th:inline="javascript">
                            function cargarOrdenarFunciones() {
                            var productoId = $('#select-ordenarFunciones').val();

                            if (productoId) {
                            var url = /*[[@{/productos/{id}/buscarFunciones}]]*/ '';
                            url = url.replace('{id}', productoId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar la tabla de funciones
                            $('#ordenarFunciones tbody').empty();

                            // Iterar sobre las funciones y generar las filas de la tabla
                            $.each(data, function(index, funcion) {
                            var fila = $('<tr>');
                            fila.append('<td>' + funcion.funcion_es + '</td>');
                            fila.append('<input type="hidden" name="id" value="' + funcion.id + '">');
                            fila.append('<td><input type="number" name="posicion" value="' + funcion.posicion + '"></td>');

                            $('#ordenarFunciones tbody').append(fila);
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las funciones del producto');
                            }
                            });
                            } else {
                            $('#ordenarFunciones tbody').empty();
                            }
                            }
                        </script>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ordenar Linea -->
        <div class="modal fade" id="ordenarLinea" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Ordenar Linea</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <form th:action="@{/ordenarLinea}" method="post">
                            <label for="producto">Seleccionar Producto:</label>
                            <select name="producto" id="select-producto-ordenarLinea" onchange="cargarFuncionesOrdenarLinea()">
                                <option value="">Seleccionar</option>
                                <!-- Iterar sobre los productos y generar las opciones del select -->
                                <option th:each="producto : ${producto}" th:value="${producto.id}" th:text="${producto.producto_es}"></option>
                            </select>

                            <label for="funcion">Seleccionar Función:</label>
                            <select name="funcion" id="select-funcion" onchange="cargarLineasOrdenarLineas()">
                                <option value="">Seleccionar</option>
                            </select>

                            <!-- Tabla de líneas -->
                            <table id="ordenarLineas">
                                <thead>
                                    <tr>
                                        <th>Modelo</th>
                                        <th>Posición</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>

                            <button type="submit">Guardar cambios</button>
                        </form>

                        <script th:inline="javascript">
                            function cargarFuncionesOrdenarLinea() {
                            var productoId = $('#select-producto-ordenarLinea').val();

                            if (productoId) {
                            var url = /*[[@{/productos/{id}/buscarFunciones}]]*/ '';
                            url = url.replace('{id}', productoId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar el select de funciones
                            $('#select-funcion').empty();
                            $('#select-funcion').append('<option value="">Seleccionar</option>');

                            // Iterar sobre las funciones y generar las opciones del select
                            $.each(data, function(index, funcion) {
                            $('#select-funcion').append('<option value="' + funcion.id + '">' + funcion.funcion_es + '</option>');
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las funciones del producto');
                            }
                            });
                            } else {
                            $('#select-funcion').empty();
                            $('#ordenarLineas tbody').empty();
                            }
                            }

                            function cargarLineasOrdenarLineas() {
                            var funcionId = $('#select-funcion').val();

                            if (funcionId) {
                            var url = /*[[@{/funciones/{id}/buscarLineas}]]*/ '';
                            url = url.replace('{id}', funcionId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar la tabla de líneas
                            $('#ordenarLineas tbody').empty();

                            // Iterar sobre las líneas y generar las filas de la tabla
                            $.each(data, function(index, linea) {
                            var fila = $('<tr>');
                            fila.append('<td>' + linea.modelo + '</td>');
                            fila.append('<td><input type="hidden" name="id" value="' + linea.id + '">' +
                            '<input type="number" name="posicion" value="' + linea.posicion + '"></td>');

                            $('#ordenarLineas tbody').append(fila);
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las líneas de la función');
                            }
                            });
                            } else {
                            $('#ordenarLineas tbody').empty();
                            }
                            }
                        </script>



                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fotos Linea -->
        <div class="modal fade" id="fotosLinea" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Fotos Linea</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <form th:action="@{/fotoLinea}" method="post" enctype="multipart/form-data">
                            <label for="producto">Seleccionar Producto:</label>
                            <select name="producto" id="select-producto-fotosLinea" onchange="cargarFuncionesfotosLinea()">
                                <option value="">Seleccionar</option>
                                <!-- Iterar sobre los productos y generar las opciones del select -->
                                <option th:each="producto : ${producto}" th:value="${producto.id}" th:text="${producto.producto_es}"></option>
                            </select>

                            <label for="funcion">Seleccionar Función:</label>
                            <select name="funcion" id="select-funcion-fotosLinea" onchange="cargarLineasfotosLineas()">
                                <option value="">Seleccionar</option>
                            </select>

                            <!-- Tabla de líneas -->
                            <table id="fotosLineas">
                                <thead>
                                    <tr>
                                        <th>Modelo</th>
                                        <th>Configuracion</th>
                                        <th>Fotos</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>

                            <button type="submit">Guardar cambios</button>
                        </form>

                        <script th:inline="javascript">
                            function cargarFuncionesfotosLinea() {
                            var productoId = $('#select-producto-fotosLinea').val();

                            if (productoId) {
                            var url = /*[[@{/productos/{id}/buscarFunciones}]]*/ '';
                            url = url.replace('{id}', productoId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar el select de funciones
                            $('#select-funcion-fotosLinea').empty();
                            $('#select-funcion-fotosLinea').append('<option value="">Seleccionar</option>');

                            // Iterar sobre las funciones y generar las opciones del select
                            $.each(data, function(index, funcion) {
                            $('#select-funcion-fotosLinea').append('<option value="' + funcion.id + '">' + funcion.funcion_es + '</option>');
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las funciones del producto');
                            }
                            });
                            } else {
                            $('#select-funcion-fotosLinea').empty();
                            $('#fotosLineas tbody').empty();
                            }
                            }

                            function cargarLineasfotosLineas() {
                            var funcionId = $('#select-funcion-fotosLinea').val();

                            if (funcionId) {
                            var url = /*[[@{/funciones/{id}/buscarLineas}]]*/ '';
                            url = url.replace('{id}', funcionId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar la tabla de líneas
                            $('#fotosLineas tbody').empty();

                            // Iterar sobre las líneas y generar las filas de la tabla
                            $.each(data, function(index, linea) {
                            var fila = $('<tr>');
                            fila.append('<td>' + linea.modelo + '</td>');
                            fila.append('<td>' + linea.configuracion + '</td>');
                            fila.append('<td><input type="file" name="fotos_linea_' + linea.id + '" multiple></td>');
                            fila.append('<td><input type="hidden" name="id" value="' + linea.id + '"></td>');

                            $('#fotosLineas tbody').append(fila);
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las líneas de la función');
                            }
                            });
                            } else {
                            $('#fotosLineas tbody').empty();
                            }
                            }
                        </script>



                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Editar Fotos Linea -->
        <div class="modal fade" id="editarFotosLinea" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Fotos Linea</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <label for="producto">Seleccionar Producto:</label>
                        <select name="producto" id="select-producto-editarFotos" onchange="cargarFuncionesEditarFotos()">
                            <option value="">Seleccionar</option>
                            <!-- Iterar sobre los productos y generar las opciones del select -->
                            <option th:each="producto : ${producto}" th:value="${producto.id}" th:text="${producto.producto_es}"></option>
                        </select>

                        <label for="funcion">Seleccionar Función:</label>
                        <select name="funcion" id="select-funcion-editarFotos" onchange="cargarLineasEditarFotos()">
                            <option value="">Seleccionar</option>
                        </select>

                        <!-- Tabla de líneas -->
                        <table id="tablaLineasFotos">
                            <thead>
                                <tr>
                                    <th>Modelo</th>
                                    <th>Configuracion</th>
                                    <th>Fotos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="editarFotosLineasBody">
                            </tbody>
                        </table>

                        <script th:inline="javascript">
                            function cargarFuncionesEditarFotos() {
                            var productoId = $('#select-producto-editarFotos').val();

                            if (productoId) {
                            var url = /*[[@{/productos/{id}/buscarFunciones}]]*/ '';
                            url = url.replace('{id}', productoId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            // Limpiar el select de funciones
                            $('#select-funcion-editarFotos').empty();
                            $('#select-funcion-editarFotos').append('<option value="">Seleccionar</option>');

                            // Iterar sobre las funciones y generar las opciones del select
                            $.each(data, function(index, funcion) {
                            $('#select-funcion-editarFotos').append('<option value="' + funcion.id + '">' + funcion.funcion_es + '</option>');
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las funciones del producto');
                            }
                            });
                            } else {
                            $('#select-funcion-editarFotos').empty();
                            $('#editarFotosLineasBody').empty();
                            }
                            }

                            function cargarLineasEditarFotos() {
                            var funcionId = $('#select-funcion-editarFotos').val();

                            if (funcionId) {
                            var url = /*[[@{/funciones/{id}/buscarLineas}]]*/ '';
                            url = url.replace('{id}', funcionId);

                            $.ajax({
                            url: url,
                            type: 'GET',
                            success: function(data) {
                            var editarFotosLineasBody = $('#editarFotosLineasBody');
                            editarFotosLineasBody.empty();

                            $.each(data, function(index, linea) {
                            var fila = $('<tr>');
                            fila.append('<td>' + linea.modelo + '</td>');
                            fila.append('<td>' + linea.configuracion + '</td>');

                            // Contenedor de fotos con flexbox
                            var fotosContainer = $('<div class="fotos-container"></div>');

                            $.each(linea.fotos, function(index, foto) {
                            var fotoWrapper = $('<div class="foto-wrapper"></div>');
                            fotoWrapper.append('<img class="foto-linea" src="/foto/' + foto.id + '">');
                            fotoWrapper.append('<button onclick="eliminarFoto(\'' + foto.id + '\')">Eliminar</button>');
                            fotosContainer.append(fotoWrapper);
                            });

                            var fotosColumn = $('<td>');
                            fotosColumn.append(fotosContainer);
                            fila.append(fotosColumn);

                            // Botón "eliminarTodas" en la columna de acciones
                            fila.append('<td><button onclick="eliminarTodasFotos(\'' + linea.id + '\')">Eliminar Todas</button></td>');

                            editarFotosLineasBody.append(fila);
                            });
                            },
                            error: function() {
                            console.log('Error al obtener las líneas de la función');
                            }
                            });
                            } else {
                            $('#editarFotosLineasBody').empty();
                            }
                            }

                            function eliminarFoto(id) {
                            $.ajax({
                            url: '/foto/eliminar/' + id,
                            type: 'DELETE',
                            success: function(response) {
                            alert(response);
                            location.reload();
                            },
                            error: function(xhr, status, error) {
                            alert('Error al eliminar la foto: ' + xhr.responseText);
                            }
                            });
                            }



                            function eliminarTodasFotos(lineaId) {
                            $.ajax({
                            url: '/linea/' + lineaId + '/eliminarTodasFotos',
                            type: 'DELETE',
                            success: function (response) {
                            alert(response);
                            location.reload();
                            },
                            error: function (xhr, status, error) {
                            alert('Error al eliminar las fotos: ' + error);
                            }
                            });
                            }




                        </script>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    </body>

</html>